steps:
  # 1. Checkout the code from GitHub
  - name: Checkout code
    uses: actions/checkout@v2

  # 2. Set up SSH to access the droplet
  - name: Set up SSH
    uses: webfactory/ssh-agent@v0.5.3
    with:
      ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

  # 3. Set DATABASE_URL from GitHub secrets
  - name: Set Environment Variable
    run: echo "DATABASE_URL=${{ secrets.DATABASE_URL }}" >> $GITHUB_ENV

  # 4. SSH into the droplet and pull latest code + restart app
  - name: Deploy to Droplet
    run: |
      ssh -o StrictHostKeyChecking=no root@178.128.64.173 << 'EOF'
        cd /root/sellerapp/SellersGPT
        
        git pull origin main

        # Export the DATABASE_URL inside the droplet session
        export DATABASE_URL="${{ secrets.DATABASE_URL }}"

        # Restart your app (systemd example)
        sudo systemctl restart your-app-service
      EOF
